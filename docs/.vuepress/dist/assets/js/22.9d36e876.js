(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{593:function(t,a,s){"use strict";s.r(a);var e=s(58),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("由于 P4 相关组件的升级，Python 支持从 2.x 升级为 3.x，本文基于 Ubuntu 20.04 + Python3.8 进行 P4 环境的搭建。")]),t._v(" "),s("p",[t._v("本教程安装脚本由 "),s("strong",[s("a",{attrs:{href:"https://gitee.com/poohdang",target:"_blank",rel:"noopener noreferrer"}},[t._v("poohdang")])]),t._v(" 提供，在 poohdang 脚本基础之上做了微调和补充。")]),t._v(" "),s("h2",{attrs:{id:"系统环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统环境"}},[t._v("#")]),t._v(" 系统环境")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("项目")]),t._v(" "),s("th",[t._v("详情")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("系统")]),t._v(" "),s("td",[t._v("Ubuntu 20.04")])]),t._v(" "),s("tr",[s("td",[t._v("内存")]),t._v(" "),s("td",[t._v("推荐 3G 以上")])]),t._v(" "),s("tr",[s("td",[t._v("存储")]),t._v(" "),s("td",[t._v("推荐 25G 以上")])]),t._v(" "),s("tr",[s("td",[t._v("Python 版本")]),t._v(" "),s("td",[t._v("3.x")])])])]),t._v(" "),s("p",[t._v("请确保 "),s("code",[t._v("python")]),t._v(" 命令可以访问 "),s("code",[t._v("python3")]),t._v("，使用如下命令绑定并检查：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/lib/python3.x /usr/lib/python    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将 Python3.x 链接至 Python")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查 python 和 pip 是否可以正常使用")]),t._v("\npython -V\npython -m pip -V      \n")])])]),s("h2",{attrs:{id:"环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[t._v("#")]),t._v(" 环境搭建")]),t._v(" "),s("h3",{attrs:{id:"安装-git"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-git"}},[t._v("#")]),t._v(" 安装 Git")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" update\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v("\n")])])]),s("h3",{attrs:{id:"设置工作目录并配置环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置工作目录并配置环境变量"}},[t._v("#")]),t._v(" 设置工作目录并配置环境变量")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以下目录可自定义")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/P4 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"export P4_HOME=~/P4"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" ~/.bashrc  \n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/.bashrc\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$P4_HOME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 该环境变量必须生效，后续脚本需要")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://gitee.com/poohdang/p4-env.git\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" p4-env\n")])])]),s("h3",{attrs:{id:"安装依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[t._v("#")]),t._v(" 安装依赖")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("755")]),t._v(" p4*.sh\n./p4-deps.sh\n")])])]),s("h3",{attrs:{id:"下载-p4-组件源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载-p4-组件源码"}},[t._v("#")]),t._v(" 下载 P4 组件源码")]),t._v(" "),s("h4",{attrs:{id:"组件介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件介绍"}},[t._v("#")]),t._v(" 组件介绍")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("组件名")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("功能")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("版本")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("a",{attrs:{href:"https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fmininet%2Fmininet",target:"_blank",rel:"noopener noreferrer"}},[t._v("mininet")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("网络仿真工具")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("Latest")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("a",{attrs:{href:"https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fp4lang%2Fbehavioral-model",target:"_blank",rel:"noopener noreferrer"}},[t._v("bmv2")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("支持 P4 编程的软件交换机")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("Latest")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("a",{attrs:{href:"https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fp4lang%2FPI",target:"_blank",rel:"noopener noreferrer"}},[t._v("PI")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("P4 Runtime Server")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("Latest")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("a",{attrs:{href:"https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fp4lang%2Fp4c",target:"_blank",rel:"noopener noreferrer"}},[t._v("p4c")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("P4 编译器")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("Latest")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("a",{attrs:{href:"https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fp4lang%2Ftutorials",target:"_blank",rel:"noopener noreferrer"}},[t._v("tutorials")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("P4 官方提供的快速上手教程")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("Latest")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("a",{attrs:{href:"https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fprotocolbuffers%2Fprotobuf",target:"_blank",rel:"noopener noreferrer"}},[t._v("protobuf")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("数据消息交换格式，grpc 的默认选项")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("v3.12.2")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("a",{attrs:{href:"https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc",target:"_blank",rel:"noopener noreferrer"}},[t._v("grpc")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("谷歌开发的远程程序调用（RPC）框架，PI 基于此实现")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("v1.30.0")])])])]),t._v(" "),s("h4",{attrs:{id:"直接下载-推荐"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#直接下载-推荐"}},[t._v("#")]),t._v(" 直接下载（推荐）")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./p4-git.sh\n")])])]),s("h4",{attrs:{id:"国内镜像加速"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#国内镜像加速"}},[t._v("#")]),t._v(" 国内镜像加速")]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("https://hub.fastgit.org")]),t._v("加速的仓库。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./p4-git-china.sh\n")])])]),s("h3",{attrs:{id:"编译并安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译并安装"}},[t._v("#")]),t._v(" 编译并安装")]),t._v(" "),s("p",[t._v("在运行安装脚本之前，我们需要手动修改 "),s("code",[t._v("behavioral-model/install_deps.sh")]),t._v(" 文件。")]),t._v(" "),s("p",[s("code",[t._v("BMV2")]),t._v(" 需要 "),s("code",[t._v("Thrift")]),t._v(" 依赖作为支持， 而使用 "),s("code",[t._v("Thrift")]),t._v(" 需要首先安装 "),s("code",[t._v("libssl")]),t._v(" 。在 "),s("code",[t._v("Ubuntu 18.04")]),t._v(" 中，"),s("code",[t._v("libssl")]),t._v(" 的 apt 包名为 "),s("code",[t._v("libssl1.0-dev")]),t._v("，在 "),s("code",[t._v("Ubuntu 20.04")]),t._v(" （以及 18.04 之前的版本）中 apt 包名为 "),s("code",[t._v("libssl-dev")]),t._v("。但在 "),s("code",[t._v("install_deps.sh")]),t._v(" 中，我们可以看到，开发组在 20.04 仍中使用 "),s("code",[t._v("libssl1.0-dev")]),t._v(" ，对此我们进行简单的修改。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" install_deps.sh\n")])])]),s("p",[t._v("将 "),s("code",[t._v('if [[ "${ubuntu_release}" > "18" ]]')]),t._v(" 的条件判断从 "),s("code",[t._v(">")]),t._v(" 修改为 "),s("code",[t._v("=")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ubuntu_release")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("lsb_release -s -r"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ubuntu_release}")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This older package libssl1.0-dev enables compiling Thrift 0.9.2")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# on Ubuntu 18.04.  Package libssl-dev exists, but Thrift 0.9.2")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fails to compile when it is installed.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TBD: whether using this package makes a difference for Ubuntu")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 18.04 and Thrift 0.11.0.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LIBSSL_DEV")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"libssl1.0-dev"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LIBSSL_DEV")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"libssl-dev"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),s("p",[t._v("最后执行安装脚本，并耐心地进行等待。如果配置的内存过低，系统可能会在编译阶段失去响应。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./p4-install.sh\n")])])]),s("h3",{attrs:{id:"为-sudo-python-添加模块搜索路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为-sudo-python-添加模块搜索路径"}},[t._v("#")]),t._v(" 为 sudo python 添加模块搜索路径")]),t._v(" "),s("p",[t._v("由于安装过程中，一部分命令需要以 "),s("code",[t._v("sudo")]),t._v(" 的权限执行，导致部分 Python 依赖被安装在了 "),s("code",[t._v("root")]),t._v(" 用户的目录下，而另一部分被安装在了普通用户的目录下。而我们通常使用 "),s("code",[t._v("sudo make")]),t._v(" 运行 P4 程序，在 "),s("code",[t._v("sudo python")]),t._v(" 搜索路径中找不到 "),s("code",[t._v("python")]),t._v(" 中安装的依赖。")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("/usr/local/lib/python3.8/dist-packages")]),t._v(" 下新建 "),s("code",[t._v("xx.pth")]),t._v(" 文件，输入：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("/home/用户名/.local/lib/python3.8/site-packages\n/usr/local/lib/python3.8/site-packages\n")])])]),s("p",[t._v("如果你完全使用以上脚本安装，将上述内容写入 "),s("code",[t._v("xx.pth")]),t._v(" 中即可正常使用 P4。")]),t._v(" "),s("p",[t._v("可使用以下命令检查 "),s("code",[t._v("sudo python")]),t._v(" 的搜索路径：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\nsys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path\n")])])]),s("p",[t._v("附上可以正常使用的 path：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("'', \n'/usr/lib/python38.zip', \n'/usr/lib/python3.8', \n'/usr/lib/python3.8/lib-dynload', \n'/usr/local/lib/python3.8/dist-packages', \n'/usr/local/lib/python3.8/dist-packages/protobuf-3.12.2-py3.8-linux-x86_64.egg',\n'/usr/local/lib/python3.8/dist-packages/thrift-0.11.0-py3.8-linux-x86_64.egg', \n'/home/p4/.local/lib/python3.8/site-packages', \n'/usr/local/lib/python3.8/site-packages', \n'/usr/lib/python3/dist-packages'\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);